# ==========================================
# LOCAL AUTH SERVICE - ENVIRONMENT VARIABLES
# ==========================================
# LocalStack-equivalent authentication service for Sepulki platform
# Provides local development authentication mimicking production Auth.js behavior

# ==========================================
# NODE ENVIRONMENT
# ==========================================
NODE_ENV=development

# ==========================================
# SERVER CONFIGURATION
# ==========================================
# Port for the authentication service
PORT=4446

# Host binding (use 0.0.0.0 for Docker, localhost for local dev)
HOST=0.0.0.0

# ==========================================
# DATABASE CONFIGURATION (PostgreSQL)
# ==========================================
# PostgreSQL connection string (same database as Hammer Orchestrator)
# Development: postgresql://smith:forge_dev@localhost:5432/sepulki
# Production: Use managed database (AWS RDS, Supabase, etc.)
DATABASE_URL=postgresql://smith:forge_dev@localhost:5432/sepulki

# Database connection pool settings
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10
DATABASE_IDLE_TIMEOUT_MS=30000
DATABASE_CONNECTION_TIMEOUT_MS=5000

# ==========================================
# REDIS CONFIGURATION
# ==========================================
# Redis connection string for session storage
# Development: redis://localhost:6379
# Production: redis://username:password@host:port/db
REDIS_URL=redis://localhost:6379

# Redis session TTL (in seconds) - 24 hours by default
REDIS_SESSION_TTL=86400

# Redis key prefix for sessions
REDIS_SESSION_PREFIX=session:

# ==========================================
# JWT CONFIGURATION
# ==========================================
# JWT secret for token signing (MUST match Hammer Orchestrator)
# Generate with: openssl rand -base64 32
# ⚠️  WARNING: This must be the same across all services!
JWT_SECRET=local-auth-jwt-secret

# JWT token expiration (in seconds or time string like '24h')
JWT_EXPIRATION=24h

# JWT issuer
JWT_ISSUER=sepulki-platform

# JWT algorithm (HS256, HS384, HS512, RS256, etc.)
JWT_ALGORITHM=HS256

# ==========================================
# SESSION CONFIGURATION
# ==========================================
# Session cookie name (must match NextAuth.js)
SESSION_COOKIE_NAME=next-auth.session-token

# Session cookie domain (use 'localhost' for local dev, '.your-domain.com' for production)
SESSION_COOKIE_DOMAIN=localhost

# Session cookie path
SESSION_COOKIE_PATH=/

# Session cookie secure flag (true for production HTTPS)
SESSION_COOKIE_SECURE=false

# Session cookie same-site policy (strict, lax, or none)
SESSION_COOKIE_SAME_SITE=lax

# Session cookie HTTP-only flag (should always be true)
SESSION_COOKIE_HTTP_ONLY=true

# Session max age (in milliseconds) - 24 hours
SESSION_MAX_AGE=86400000

# ==========================================
# CORS CONFIGURATION
# ==========================================
# Allowed origins for CORS (comma-separated)
# Development: http://localhost:3000,http://127.0.0.1:3000
# Production: https://your-domain.com,https://www.your-domain.com
CORS_ORIGIN=http://localhost:3000,http://127.0.0.1:3000

# Enable credentials in CORS (required for cookies)
CORS_CREDENTIALS=true

# ==========================================
# PASSWORD HASHING
# ==========================================
# bcrypt rounds (10-12 recommended, higher = more secure but slower)
BCRYPT_ROUNDS=10

# Password hash algorithm (use sha256 to match seed data, bcrypt for production)
# Options: sha256, bcrypt
PASSWORD_HASH_ALGORITHM=sha256

# ==========================================
# OAUTH PROVIDERS (Optional)
# ==========================================
# Local Hydra OAuth server configuration (for testing OAuth flows locally)
# LOCAL_OAUTH_ISSUER=http://localhost:4444
# LOCAL_OAUTH_CLIENT_ID=sepulki-forge
# LOCAL_OAUTH_CLIENT_SECRET=sepulki-forge-secret

# GitHub OAuth (for production)
# GITHUB_CLIENT_ID=your-github-oauth-client-id
# GITHUB_CLIENT_SECRET=your-github-oauth-client-secret

# Google OAuth (for production)
# GOOGLE_CLIENT_ID=your-google-oauth-client-id
# GOOGLE_CLIENT_SECRET=your-google-oauth-client-secret

# ==========================================
# EMAIL CONFIGURATION
# ==========================================
# Email service for password resets and verification (optional)
# Development: Use MailHog at localhost:1025
EMAIL_SERVER=smtp://localhost:1025
EMAIL_FROM=noreply@sepulki.local

# Production email service (SendGrid, AWS SES, etc.)
# EMAIL_SERVER=smtp://smtp.sendgrid.net:587
# EMAIL_FROM=noreply@sepulki.com
# SENDGRID_API_KEY=your-sendgrid-api-key

# Email verification enabled
EMAIL_VERIFICATION_ENABLED=false

# Password reset token expiration (in seconds)
PASSWORD_RESET_TOKEN_EXPIRATION=3600

# ==========================================
# RATE LIMITING
# ==========================================
# Enable rate limiting for authentication endpoints
RATE_LIMIT_ENABLED=true

# Rate limit window (in milliseconds)
RATE_LIMIT_WINDOW_MS=60000

# Maximum login attempts per window
RATE_LIMIT_MAX_LOGIN_ATTEMPTS=5

# Maximum registration attempts per window
RATE_LIMIT_MAX_REGISTER_ATTEMPTS=3

# ==========================================
# LOGGING CONFIGURATION
# ==========================================
# Log level: error, warn, info, debug
LOG_LEVEL=info

# Log format: json or pretty
LOG_FORMAT=pretty

# Enable authentication audit logging
LOG_AUTH_EVENTS=true

# ==========================================
# SECURITY SETTINGS
# ==========================================
# Enable account lockout after failed login attempts
ENABLE_ACCOUNT_LOCKOUT=false

# Number of failed attempts before lockout
ACCOUNT_LOCKOUT_THRESHOLD=5

# Lockout duration (in seconds)
ACCOUNT_LOCKOUT_DURATION=1800

# Enable two-factor authentication (2FA)
ENABLE_2FA=false

# 2FA token expiration (in seconds)
TWO_FA_TOKEN_EXPIRATION=300

# ==========================================
# CSRF PROTECTION
# ==========================================
# Enable CSRF token validation
ENABLE_CSRF=false

# CSRF token secret
# CSRF_SECRET=your-csrf-secret

# ==========================================
# ERROR TRACKING (Sentry)
# ==========================================
# Sentry DSN for error tracking (optional)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/your-project-id

# Sentry environment
# SENTRY_ENVIRONMENT=development

# ==========================================
# DEVELOPMENT SETTINGS
# ==========================================
# Enable debug mode (shows detailed error messages)
DEBUG_MODE=true

# Show login page with test user credentials
SHOW_TEST_USERS=true

# Auto-login for development (bypasses authentication)
# ⚠️  WARNING: NEVER enable in production!
# AUTO_LOGIN_ENABLED=false
# AUTO_LOGIN_EMAIL=dev@sepulki.com

# ==========================================
# TEST USERS (Development Only)
# ==========================================
# These are seeded in the database via SQL scripts
# Default password for all test users (hashed with SHA256 in seed data)
DEFAULT_TEST_PASSWORD=dev123

# Test user emails:
# - dev@sepulki.com (OVER_SMITH role)
# - demo@sepulki.com (SMITH role)
# - test@sepulki.com (OVER_SMITH role)
# - admin@sepulki.com (ADMIN role)

# ==========================================
# HEALTH CHECK CONFIGURATION
# ==========================================
# Health check endpoint path
HEALTH_CHECK_PATH=/health

# ==========================================
# DEPLOYMENT PLATFORM VARIABLES
# ==========================================
# These are typically auto-set by deployment platforms

# Railway variables (auto-detected)
# RAILWAY_ENVIRONMENT=production

# Render variables (auto-detected)
# RENDER_EXTERNAL_URL=auto-detected

# ==========================================
# WEBHOOK CALLBACKS
# ==========================================
# Callback URL for frontend redirects after authentication
# Development: http://localhost:3000
# Production: https://your-domain.com
CALLBACK_URL=http://localhost:3000

# Sign-in page URL
SIGNIN_URL=http://localhost:4446/auth/signin

# ==========================================
# NOTES:
# ==========================================
# 1. NEVER commit .env files with real secrets to version control
# 2. JWT_SECRET MUST match across all services (local-auth and hammer-orchestrator)
# 3. Use strong, unique secrets for production
# 4. Generate secrets using: openssl rand -base64 32
# 5. In production, use bcrypt for password hashing instead of sha256
# 6. Ensure Redis is properly secured in production (use AUTH password)
# 7. Enable SSL for database and Redis connections in production
# 8. Set SESSION_COOKIE_SECURE=true in production (requires HTTPS)
# 9. Disable SHOW_TEST_USERS and AUTO_LOGIN_ENABLED in production
# 10. Consider using a secrets manager (AWS Secrets Manager, HashiCorp Vault) for production

# ==========================================
# PRODUCTION/DEPLOYMENT CONFIGURATION
# ==========================================

# Database
DATABASE_URL=postgresql://user:password@your-neon-host/sepulki?sslmode=require

# Redis Configuration  
REDIS_URL=rediss://:password@your-redis.upstash.io:6379

# JWT & Session Secrets
JWT_SECRET=<generate-with-openssl-rand-base64-32>
SESSION_SECRET=<generate-with-openssl-rand-base64-32>

# Service Configuration
PORT=3001
NODE_ENV=production

# CORS Configuration
CORS_ORIGIN=https://your-domain.vercel.app

# Rate Limiting
RATE_LIMIT_ENABLED=true
LOGIN_RATE_LIMIT_MAX=5
LOGIN_RATE_LIMIT_WINDOW_MS=900000

# Session Configuration
SESSION_TTL=86400
COOKIE_SECURE=true
COOKIE_DOMAIN=your-domain.com

# ==========================================
# MONITORING & LOGGING
# ==========================================

# Sentry (optional)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
# SENTRY_ENVIRONMENT=production

# Log Level
LOG_LEVEL=info
